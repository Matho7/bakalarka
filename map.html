<!DOCTYPE html>
<html>
<head>
    <title>Google Maps Directions</title>
    <style>
        /* Set the map container size */
        #map {
            width: 100%;
            height: 400px;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        function initMap() {
            var api_key = '{{ api_key }}'; // Use the template variable here

            var originCoords = { lat: {{ originCoords[0] }}, lng: {{ originCoords[1] }} };
            var destCoords = { lat: {{ destCoords[0] }}, lng: {{ destCoords[1] }} };
            var travelMode = '{{ travelMode }}'; // Use single quotes for string literals
            var waypoints = waypoints; // Parse the waypoints from the template

            var map = new google.maps.Map(document.getElementById('map'), {
                center: originCoords,
                zoom: 12
            });

            // Add markers for origin and destination
            var originMarker = new google.maps.Marker({
                position: originCoords,
                map: map,
                title: 'Origin'
            });

            var destMarker = new google.maps.Marker({
                position: destCoords,
                map: map,
                title: 'Destination'
            });

            // Create a directions service and renderer
            var directionsService = new google.maps.DirectionsService();
            var directionsRenderer = new google.maps.DirectionsRenderer({
                map: map
            });

            // Set up the request
            var request = {
                origin: originCoords,
                destination: destCoords,
                travelMode: travelMode,
                waypoints: []
            };

            // Add the waypoints to the request
            for (var i = 0; i < waypoints.length; i++) {
                request.waypoints.push({
                    location: waypoints[i],
                    stopover: true
                });
            }

            // Get directions and display them on the map
            directionsService.route(request, function(response, status) {
                if (status === 'OK') {
                    directionsRenderer.setDirections(response);
                }
            });
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&callback=initMap" async defer></script>
</body>
</html>
